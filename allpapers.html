<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <title>All Research Papers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body class="bg-[#0f172a] text-white font-sans min-h-screen">
  <header class="p-6 text-center">
    <h1 class="text-4xl font-extrabold text-cyan-400">ğŸ“„ All Research Papers</h1>
    <p class="text-gray-300 mt-2">Browse the full collection published by students</p>
    
    <!-- âœ… Fixed Back Button -->
    <button onclick="window.location.href='homepage.html'" class="mt-4 bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-2 rounded-lg shadow-md transition">
      â¬…ï¸ Back to Search
    </button>
  </header>

  <section class="mt-10 px-8 md:px-20">
    <div id="paperContainer" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <!-- Papers will be loaded here -->
    </div>

    <div id="loading" class="text-center text-gray-400 mt-6 hidden">Loading more papers...</div>
    <div id="endText" class="text-center text-gray-500 mt-6 hidden">ğŸ‰ You've reached the end!</div>
  </section>

  <script>
    let currentPage = 1;
    const limit = 12;
    let totalResults = 0;
    let loading = false;

    const paperContainer = document.getElementById("paperContainer");
    const loadingText = document.getElementById("loading");
    const endText = document.getElementById("endText");

    async function fetchPapers() {
      if (loading) return;
      loading = true;
      loadingText.classList.remove("hidden");

      try {
        const response = await fetch(`http://localhost:3000/search?term=&page=${currentPage}&limit=${limit}`);
        const data = await response.json();
        const papers = data.data || data.papers || []; // fallback for older backend format

        renderPapers(papers);
        totalResults = data.total || papers.length;

        const loadedSoFar = currentPage * limit;
        if (loadedSoFar >= totalResults) {
          endText.classList.remove("hidden");
        } else {
          currentPage++;
        }
      } catch (err) {
        console.error("Failed to fetch papers:", err);
      } finally {
        loading = false;
        loadingText.classList.add("hidden");
      }
    }

    function renderPapers(papers) {
      papers.forEach(paper => {
        paperContainer.innerHTML += `
          <div class="bg-[#1e293b] p-6 rounded-2xl shadow-xl border border-cyan-400/30">
            <h3 class="text-xl font-bold text-cyan-300">${paper.title}</h3>
            <p class="text-gray-300">Author: ${paper.author}</p>
            <p class="text-sm text-gray-400">Domain: ${paper.domain} | Year: ${paper.year}</p>
            <p class="mt-2 text-gray-200 text-sm">${paper.keywords}</p>
            <button class="mt-3 bg-cyan-500 hover:bg-cyan-600 px-4 py-1 rounded text-white text-sm">View</button>
          </div>
        `;
      });
    }

    // Load first batch
    fetchPapers();

    // Infinite scroll
    window.addEventListener("scroll", () => {
      const nearBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 200;
      const loadedSoFar = currentPage * limit;

      if (nearBottom && !loading && loadedSoFar < totalResults) {
        fetchPapers();
      }
    });
  </script>
</body>
</html>
