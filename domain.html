<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <title>Domain-wise Papers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-[#0f172a] via-[#1e293b] to-[#4f46e5] text-white min-h-screen font-sans p-6">

  <!-- âœ… Title and Back Button -->
  <header class="text-center mb-6">
    <h1 class="text-3xl font-bold" id="domainTitle">Loading...</h1>
    <button onclick="window.location.href='homepage.html'" class="mt-4 bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-2 rounded-lg shadow-md transition">
      â¬…ï¸ Back to Search
    </button>
  </header>

  <!-- âœ… Paper Grid -->
  <div id="paperContainer" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>

  <!-- âœ… Loading and End messages -->
  <div id="loading" class="text-center text-gray-300 mt-6 hidden">Loading more papers...</div>
  <div id="endMessage" class="text-center text-gray-400 mt-6 hidden">ğŸ‰ Youâ€™ve reached the end.</div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const domain = params.get("domain");
    const domainTitle = document.getElementById("domainTitle");
    const container = document.getElementById("paperContainer");
    const loading = document.getElementById("loading");
    const endMessage = document.getElementById("endMessage");

    domainTitle.innerText = `ğŸ“š Papers in Domain: ${domain}`;

    let currentPage = 1;
    const limit = 12;
    let loadingInProgress = false;
    let totalPapers = 0;

    function loadPapers() {
      if (loadingInProgress) return;
      loadingInProgress = true;
      loading.classList.remove("hidden");

      fetch(`http://localhost:3000/search?term=${encodeURIComponent(domain)}&page=${currentPage}&limit=${limit}`)
        .then(response => response.json())
        .then(data => {
          const papers = data.papers || data.data || [];
          totalPapers = data.total;

          if (papers.length === 0 && currentPage === 1) {
            container.innerHTML = `<p class="text-center text-gray-400 col-span-full">No papers found for this domain.</p>`;
            loading.classList.add("hidden");
            return;
          }

          papers.forEach(paper => {
            container.innerHTML += `
              <div class="bg-[#1e293b] p-6 rounded-2xl shadow-xl border border-cyan-400/30">
                <h3 class="text-xl font-bold text-cyan-300">${paper.title}</h3>
                <p class="text-gray-300">Author: ${paper.author}</p>
                <p class="text-sm text-gray-400">Domain: ${paper.domain} | Year: ${paper.year}</p>
                <p class="mt-2 text-gray-200 text-sm">${paper.keywords || ''}</p>
                <button class="mt-3 bg-cyan-500 hover:bg-cyan-600 px-4 py-1 rounded text-white text-sm">View</button>
              </div>
            `;
          });

          loading.classList.add("hidden");
          loadingInProgress = false;

          const totalPages = Math.ceil(totalPapers / limit);
          if (currentPage >= totalPages) {
            endMessage.classList.remove("hidden");
          } else {
            currentPage++;
          }
        })
        .catch(error => {
          console.error("Error fetching domain papers:", error);
          loading.classList.add("hidden");
          loadingInProgress = false;
        });
    }

    // Initial load
    loadPapers();

    // Infinite Scroll
    window.addEventListener("scroll", () => {
      const bottomReached = window.innerHeight + window.scrollY >= document.body.offsetHeight - 200;
      if (bottomReached && !loadingInProgress && (currentPage - 1) * limit < totalPapers) {
        loadPapers();
      }
    });
  </script>
</body>
</html>
